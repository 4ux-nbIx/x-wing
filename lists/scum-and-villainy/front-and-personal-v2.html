<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Front and Personal v2</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xwing-miniatures-font/dist/xwing-miniatures.css" />
<style>
body { 
  font-family: Arial, sans-serif; 
  margin: 1rem; 
  overflow-x: auto;
  overflow-y: auto;
  -webkit-text-size-adjust: 100%;
}

@media screen and (max-width: 768px) {
  body { margin: 0.5rem; }
  h1 { font-size: 1.3rem; }
  th, td { font-size: 12px; padding: 3px 4px; }
  
  /* Focus view mobile fixes */
  #focusedContainer {
    height: calc(100vh - 50px) !important;
    padding: 5px 5px 0 5px !important;
    padding-bottom: 60px !important;
    width: 100vw !important;
    overflow: auto !important;
  }
  
  #focusedContainer .content-wrapper {
    max-width: calc(100vw - 10px) !important;
    width: 100% !important;
  }
  
  #focusedContainer .table-container {
    width: 100% !important;
    max-width: 100% !important;
    overflow-x: auto !important;
  }
  
  #focusedContainer table {
    width: 100% !important;
    table-layout: auto !important;
  }
  
  #focusedContainer table th:not(.step-col),
  #focusedContainer table td:not(.event-label) {
    width: auto !important;
    min-width: auto !important;
    max-width: none !important;
  }
  
  #focusedView .focus-nav-controls {
    width: 100vw !important;
    left: 0 !important;
    transform: none !important;
    height: 50px !important;
    padding: 5px 10px !important;
    min-width: unset !important;
    box-sizing: border-box !important;
  }
  
  #focusedView .focus-nav-controls button {
    min-width: 32px !important;
    min-height: 32px !important;
    font-size: 16px !important;
    padding: 4px 8px !important;
  }
  
  #focusedView .focus-nav-controls #focusInfo {
    font-size: 10px !important;
    padding: 0 8px !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
    line-height: 1.2 !important;
  }
}
h1 { font-size: 1.5rem; }
.table-container { 
  width: 100%; 
}
table { 
  border-collapse: collapse; 
  table-layout: auto; 
  width: max-content;
  min-width: 100%;
}
th, td { 
  border: 1px solid #999; 
  padding: 4px 6px; 
  vertical-align: top; 
  font-size: 13px;
  height: auto;
}
th { background: #eee; }
th.step-col, td.event-label { 
  width: auto; 
  min-width: fit-content;
  max-width: fit-content;
  background:#f0f0f0; 
  font-weight:600; 
}
th.step-col { writing-mode: vertical-rl; text-orientation: mixed; text-align: center; }
th:not(.step-col), td:not(.event-label) { 
  width: 300px;
  min-width: 300px;
  max-width: 300px;
  word-wrap: break-word; 
}
td.event-label { text-align: center; writing-mode: vertical-rl; text-orientation: mixed; }
.phase-header-row { background: #333; }
.phase-header { background: #333; color: white; text-align: center; font-weight: bold; padding: 8px; font-size: 14px; }
.hdr-ship { font-weight: 600; }
.hdr-pilot { margin-top: 2px; }
.hdr-device { font-weight: 600; }
.hdr-device-name { margin-top: 2px; }
th .init { font-weight: normal; color: #555; }
.upgrade-name { font-weight: 600; }
.upgrade-name i { margin-right: 2px; }
.pilot-ability i { margin-right: 2px; }
.ability { margin: 2px 0; line-height: 1.2; }
.ability .xwing-miniatures-font { font-size: 13px; }
.pilot-ability { margin-top: 2px; }
.pilot-block { margin-bottom: 6px; }
.upgrade-block { margin-bottom: 6px; }
.phase-cell.empty { background: #fafafa; }
.xwing-miniatures-font { font-family: 'xwing-miniatures'; font-style: normal; }
code { background: #f5f5f5; padding: 1px 3px; border-radius: 3px; }
mark { background: #ffeb3b; padding: 1px 2px; border-radius: 2px; font-weight: 600; }
.de-emphasized { opacity: 0.6; font-weight: normal; }
/* Sticky headers and phase rows */
thead th { position: sticky; top: 0; z-index: 10; background: #eee; }
.phase-header-row { position: sticky; top: 46px; z-index: 9; background: #333; }
.phase-header { background: #333; color: white; text-align: center; font-weight: bold; padding: 8px; font-size: 14px; }

/* Focus mode styles */
.header-container {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
}
.focus-controls { 
  display: inline-flex;
  align-items: center;
}
.focus-controls button { 
  margin: 0; 
  padding: 6px 12px; 
  border: 1px solid #ccc; 
  background: #f8f9fa; 
  border-radius: 4px; 
  cursor: pointer; 
  font-size: 14px;
  min-height: 44px;
  touch-action: manipulation;
}
.focus-controls button:hover { background: #e9ecef; }
.focus-controls button:disabled { 
  opacity: 0.5; 
  cursor: not-allowed; 
  background: #f8f9fa; 
}

#focusedView {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.9);
  display: none;
  flex-direction: column;
  z-index: 1000;
}

#focusedView .focus-nav-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  background: white;
  padding: 15px;
  margin: 0;
  height: 60px;
  box-sizing: border-box;
  flex-shrink: 0;
  border-top: 1px solid #ddd;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1001;
  width: max-content;
  min-width: 300px;
}

#focusedView .focus-nav-controls #focusInfo {
  color: #333;
  font-weight: 600;
  font-size: 14px;
  white-space: normal;
  word-wrap: break-word;
  text-align: center;
  line-height: 1.2;
  flex: 1;
  min-width: 0;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

#focusedView .focus-nav-controls button {
  background: #007acc;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  min-width: 44px;
  min-height: 44px;
  touch-action: manipulation;
}

#focusedView .focus-nav-controls button:hover {
  background: #005a9e;
}

#focusedView .focus-nav-controls button:disabled {
  background: #666;
  cursor: not-allowed;
}

#focusedContainer {
  width: 100vw;
  height: calc(100vh - 80px); /* Account for navigation controls */
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow: auto;
  padding: 20px 0 0 0;
  margin: 0;
  background: white;
  box-sizing: border-box;
}

#focusedContainer .content-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  width: max-content;
  max-width: calc(100vw - 40px);
  min-height: min-content;
}

#focusedContainer .table-container {
  width: max-content;
  overflow: visible;
  display: block;
}

#focusedContainer table {
  table-layout: fixed;
  width: max-content;
  margin: 0;
  border-collapse: collapse;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

#focusedContainer table th,
#focusedContainer table td {
  height: auto;
  vertical-align: top;
  padding: 4px 6px;
  border: 1px solid #999;
  font-size: 13px;
}

#focusedContainer table th {
  background: #eee;
}

#focusedContainer table th.step-col,
#focusedContainer table td.event-label {
  width: auto;
  min-width: fit-content;
  max-width: fit-content;
  background: #f0f0f0;
  font-weight: 600;
}

@media screen and (max-width: 768px) {
  #focusedContainer table th.step-col,
  #focusedContainer table td.event-label {
    width: auto !important;
    min-width: fit-content !important;
  }
}

#focusedContainer table td.event-label {
  text-align: center;
  writing-mode: vertical-rl;
  text-orientation: mixed;
}

#focusedContainer table th.step-col {
  writing-mode: vertical-rl;
  text-orientation: mixed;
  text-align: center;
}

#focusedContainer table th:not(.step-col),
#focusedContainer table td:not(.event-label) {
  width: 300px;
  min-width: 300px;
  max-width: 300px;
  word-wrap: break-word;
}

/* Focus view additional styling */
#focusedView {
  /* No additional padding needed with new layout */
}

/* Ensure phase header rows stick properly in focus view */
#focusedContainer .phase-header-row {
  position: sticky;
  top: 0;
  z-index: 9;
  background: #333;
}

#focusedContainer .phase-header {
  background: #333;
  color: white;
  text-align: center;
  font-weight: bold;
  padding: 8px;
  font-size: 14px;
}

/* Ensure header cells stick in focus view */
#focusedContainer thead th {
  position: sticky;
  top: 0;
  z-index: 10;
  background: #eee;
}

.hidden { display: none !important; }
</style>
</head>
<body>
<div class="header-container">
  <h1>Front and Personal v2</h1>
  <div class="focus-controls">
    <button onclick="toggleFocusMode()">â–¶ Play</button>
  </div>
</div>

<div id="tableContainer" class="table-container">
  <table id="mainTable">
    <thead><tr><th class="step-col planning_phase-set_maneuver system_phase activation_phase-activation start_of_engagement_phase engagement_phase-engage unit-0 unit-1 unit-2 unit-3">Step</th><th class="planning_phase-set_maneuver system_phase activation_phase-activation start_of_engagement_phase engagement_phase-engage unit-0"><div class="hdr-ship"><i class="xwing-miniatures-ship xwing-miniatures-ship-lancerclasspursuitcraft" title="Lancer-class Pursuit Craft"></i> <span class="ship-name">Lancer-class Pursuit Craft</span></div><div class="hdr-pilot"><span class="upgrade-name">Ketsu Onyo</span> <span class="init">(i5)</span></div></th><th class="planning_phase-set_maneuver system_phase activation_phase-activation start_of_engagement_phase engagement_phase-engage unit-1"><div class="hdr-ship"><i class="xwing-miniatures-ship xwing-miniatures-ship-starviperclassattackplatform" title="StarViper-class Attack Platform"></i> <span class="ship-name">StarViper-class Attack Platform</span></div><div class="hdr-pilot"><span class="upgrade-name">Guri</span> <span class="init">(i5)</span></div></th><th class="planning_phase-set_maneuver system_phase activation_phase-activation start_of_engagement_phase engagement_phase-engage unit-2"><div class="hdr-ship"><i class="xwing-miniatures-ship xwing-miniatures-ship-kihraxzfighter" title="Kihraxz Fighter"></i> <span class="ship-name">Kihraxz Fighter</span></div><div class="hdr-pilot"><span class="upgrade-name">Talonbane Cobra</span> <span class="init">(i5)</span></div></th><th class="planning_phase-set_maneuver system_phase activation_phase-activation start_of_engagement_phase engagement_phase-engage unit-3"><div class="hdr-ship"><i class="xwing-miniatures-ship xwing-miniatures-ship-fangfighter" title="Fang Fighter"></i> <span class="ship-name">Fang Fighter</span></div><div class="hdr-pilot"><span class="upgrade-name">Fenn Rau</span> <span class="init">(i6)</span></div></th></tr></thead>
    <tbody>
      <tr class="phase-header-row"><td colspan="5" class="phase-header planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3">Planning Phase</td></tr>
<tr><td class="event-label planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3" rowspan="1">Set Maneuver</td><td class="phase-cell planning_phase-set_maneuver unit-0"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-lancerclasspursuitcraft" title="Lancer-class Pursuit Craft"></i> <strong>Ketsu Onyo</strong></div><div class="ability pilot-ability">Set maneuver dial</div></div></td><td class="phase-cell planning_phase-set_maneuver unit-1"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-starviperclassattackplatform" title="StarViper-class Attack Platform"></i> <strong>Guri</strong></div><div class="ability pilot-ability">Set maneuver dial</div></div></td><td class="phase-cell planning_phase-set_maneuver unit-2"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-kihraxzfighter" title="Kihraxz Fighter"></i> <strong>Talonbane Cobra</strong></div><div class="ability pilot-ability">Set maneuver dial</div></div></td><td class="phase-cell planning_phase-set_maneuver unit-3"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-fangfighter" title="Fang Fighter"></i> <strong>Fenn Rau</strong></div><div class="ability pilot-ability">Set maneuver dial</div></div></td></tr>
<tr class="phase-header-row"><td colspan="5" class="phase-header system_phase planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3">System Phase</td></tr>
<tr><td class="event-label system_phase planning_phase-set_maneuver unit-0" rowspan="1">System Phase</td><td class="phase-cell system_phase planning_phase-set_maneuver unit-0"><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-modification" title="modification"></i> <strong>Mandalorian Optics</strong></div><div class="ability upgrade-ability"><mark>During the System Phase</mark>, you may spend 1 <i class="xwing-miniatures-font xwing-miniatures-font-charge" title="Charge" style="color: orange"></i> to acquire a lock on an object in your <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i>. While you perform a primary attack, if you have a lock on the defender, ignore obstacles beyond range 0 obstructing the attack.</div></div></td><td class="phase-cell empty system_phase planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty system_phase planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty system_phase planning_phase-set_maneuver">&nbsp;</td></tr>
<tr class="phase-header-row"><td colspan="5" class="phase-header activation_phase-activation planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3">Activation Phase</td></tr>
<tr><td class="event-label activation_phase-activation planning_phase-set_maneuver unit-0" rowspan="1">activation</td><td class="phase-cell activation_phase-activation planning_phase-set_maneuver unit-0"><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-illicit" title="illicit"></i> <strong>Contraband Cybernetics</strong></div><div class="ability upgrade-ability"><mark>Before you activate</mark>, you may spend 1 <i class="xwing-miniatures-font xwing-miniatures-font-charge" title="Charge" style="color: orange"></i>. If you do, until the end of the round, you can perform actions and execute red maneuvers, even while stressed. This card&#39;s <i class="xwing-miniatures-font xwing-miniatures-font-charge" title="Charge" style="color: orange"></i> cannot be recovered.</div></div></td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td></tr>
<tr><td class="event-label activation_phase-activation planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3" rowspan="1">Choose Action</td><td class="phase-cell activation_phase-activation planning_phase-set_maneuver unit-0"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-lancerclasspursuitcraft" title="Lancer-class Pursuit Craft"></i> <strong>Lancer-class Pursuit Craft</strong></div><div class="ability ship-ability"><mark>Action:</mark> <i class="xwing-miniatures-font xwing-miniatures-font-focus" title="Focus"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-evade" title="Evade"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-lock" title="Lock"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-rotatearc" title="Rotate Arc"></i></div></div></td><td class="phase-cell activation_phase-activation planning_phase-set_maneuver unit-1"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-starviperclassattackplatform" title="StarViper-class Attack Platform"></i> <strong>StarViper-class Attack Platform</strong></div><div class="ability ship-ability"><mark>Action:</mark> <i class="xwing-miniatures-font xwing-miniatures-font-focus" title="Focus"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-lock" title="Lock"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-barrelroll" title="Barrel Roll"></i> <i class="xwing-miniatures-font xwing-miniatures-font-linked" title="Linked"></i> <i class="xwing-miniatures-font xwing-miniatures-font-focus" title="Focus" style="color: red"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-boost" title="Boost"></i> <i class="xwing-miniatures-font xwing-miniatures-font-linked" title="Linked"></i> <i class="xwing-miniatures-font xwing-miniatures-font-focus" title="Focus" style="color: red"></i></div></div></td><td class="phase-cell activation_phase-activation planning_phase-set_maneuver unit-2"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-kihraxzfighter" title="Kihraxz Fighter"></i> <strong>Kihraxz Fighter</strong></div><div class="ability ship-ability"><mark>Action:</mark> <i class="xwing-miniatures-font xwing-miniatures-font-focus" title="Focus"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-lock" title="Lock"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-barrelroll" title="Barrel Roll"></i></div></div></td><td class="phase-cell activation_phase-activation planning_phase-set_maneuver unit-3"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-fangfighter" title="Fang Fighter"></i> <strong>Fang Fighter</strong></div><div class="ability ship-ability"><mark>Action:</mark> <i class="xwing-miniatures-font xwing-miniatures-font-focus" title="Focus"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-lock" title="Lock"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-barrelroll" title="Barrel Roll"></i> <i class="xwing-miniatures-font xwing-miniatures-font-linked" title="Linked"></i> <i class="xwing-miniatures-font xwing-miniatures-font-focus" title="Focus" style="color: red"></i>, <i class="xwing-miniatures-font xwing-miniatures-font-boost" title="Boost"></i> <i class="xwing-miniatures-font xwing-miniatures-font-linked" title="Linked"></i> <i class="xwing-miniatures-font xwing-miniatures-font-focus" title="Focus" style="color: red"></i></div></div></td></tr>
<tr><td class="event-label activation_phase-activation planning_phase-set_maneuver unit-1" rowspan="1">perform action</td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell activation_phase-activation planning_phase-set_maneuver unit-1"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-starviperclassattackplatform" title="StarViper-class Attack Platform"></i> <strong>Microthrusters</strong></div><div class="ability ship-ability"><mark>While you perform a barrel roll</mark>, you must use the <i class="xwing-miniatures-font xwing-miniatures-font-bankleft" title="Bank Left"></i> or <i class="xwing-miniatures-font xwing-miniatures-font-bankright" title="Bank Right"></i> template instead of the <i class="xwing-miniatures-font xwing-miniatures-font-straight" title="Straight"></i> template.</div></div></td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td></tr>
<tr><td class="event-label activation_phase-activation planning_phase-set_maneuver unit-0" rowspan="1">move</td><td class="phase-cell activation_phase-activation planning_phase-set_maneuver unit-0"><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-crew" title="crew"></i> <strong>Qi&#39;ra</strong></div><div class="ability upgrade-ability"><mark>While you move and perform attacks</mark>, you ignore obstacles that you are locking.</div></div></td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty activation_phase-activation planning_phase-set_maneuver">&nbsp;</td></tr>
<tr class="phase-header-row"><td colspan="5" class="phase-header start_of_engagement_phase planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3">Start of Engagement Phase</td></tr>
<tr><td class="event-label start_of_engagement_phase planning_phase-set_maneuver unit-0 unit-1" rowspan="1">Engagement Phase</td><td class="phase-cell start_of_engagement_phase planning_phase-set_maneuver unit-0"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-lancerclasspursuitcraft" title="Lancer-class Pursuit Craft"></i> <strong>Ketsu Onyo</strong></div><div class="ability pilot-ability"><mark>At the start of the Engagement Phase</mark>, you may choose 1 ship in both your <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i> and <i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc" title="Single Turret Arc" style="color: red"></i> at range 0-1. If you do, that ship gains 1 tractor token.</div></div></td><td class="phase-cell start_of_engagement_phase planning_phase-set_maneuver unit-1"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-starviperclassattackplatform" title="StarViper-class Attack Platform"></i> <strong>Guri</strong></div><div class="ability pilot-ability"><mark>At the start of the Engagement Phase, if there is at least 1 enemy ship at range 0-1</mark>, you may gain 1 focus token.</div></div></td><td class="phase-cell empty start_of_engagement_phase planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty start_of_engagement_phase planning_phase-set_maneuver">&nbsp;</td></tr>
<tr class="phase-header-row"><td colspan="5" class="phase-header engagement_phase-engage planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3">Engagement Phase</td></tr>
<tr><td class="event-label engagement_phase-engage planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3" rowspan="1">Choose Weapon</td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-0"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-lancerclasspursuitcraft" title="Lancer-class Pursuit Craft"></i> <strong>Lancer-class Pursuit Craft</strong></div><div class="ability attack-details"><strong>Primary Attack: </strong> <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i> <span style="color: red; font-weight: bold;">3</span></div><div class="ability ship-ability"></div></div><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-lancerclasspursuitcraft" title="Lancer-class Pursuit Craft"></i> <strong>Lancer-class Pursuit Craft</strong></div><div class="ability attack-details"><strong>Primary Attack: </strong> <i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc" title="Single Turret Arc" style="color: red"></i> <span style="color: red; font-weight: bold;">2</span></div><div class="ability ship-ability"></div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-1"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-starviperclassattackplatform" title="StarViper-class Attack Platform"></i> <strong>StarViper-class Attack Platform</strong></div><div class="ability attack-details"><strong>Primary Attack: </strong> <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i> <span style="color: red; font-weight: bold;">3</span></div><div class="ability ship-ability"></div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-2"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-kihraxzfighter" title="Kihraxz Fighter"></i> <strong>Kihraxz Fighter</strong></div><div class="ability attack-details"><strong>Primary Attack: </strong> <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i> <span style="color: red; font-weight: bold;">3</span></div><div class="ability ship-ability"></div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-3"><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-fangfighter" title="Fang Fighter"></i> <strong>Fang Fighter</strong></div><div class="ability attack-details"><strong>Primary Attack: </strong> <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i> <span style="color: red; font-weight: bold;">3</span></div><div class="ability ship-ability"></div></div></td></tr>
<tr><td class="event-label engagement_phase-engage planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3" rowspan="1">attacks</td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-0"><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-talent" title="talent"></i> <strong>Predator</strong></div><div class="ability upgrade-ability"><mark>While you perform a primary attack, if the defender is in your <i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc" title="Bullseye Arc" style="color: red"></i></mark>, you may reroll 1 attack die.</div></div><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-crew" title="crew"></i> <strong>Qi&#39;ra</strong></div><div class="ability upgrade-ability"><mark>While you move and perform attacks</mark>, you ignore obstacles that you are locking.</div></div><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-modification" title="modification"></i> <strong>Mandalorian Optics</strong></div><div class="ability upgrade-ability"><span class="de-emphasized">During the System Phase, you may spend 1 <i class="xwing-miniatures-font xwing-miniatures-font-charge" title="Charge" style="color: orange"></i> to acquire a lock on an object in your <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i>. </span><mark>While you perform a primary attack, if you have a lock on the defender</mark>, ignore obstacles beyond range 0 obstructing the attack.</div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-1"><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-talent" title="talent"></i> <strong>Marksmanship</strong></div><div class="ability upgrade-ability"><mark>While you perform an attack, if the defender is in your <i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc" title="Bullseye Arc" style="color: red"></i></mark>, you may change 1 <i class="xwing-miniatures-font xwing-miniatures-font-hit" title="Hit"></i> result to a <i class="xwing-miniatures-font xwing-miniatures-font-crit" title="Critical Hit"></i> result.</div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-2"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-kihraxzfighter" title="Kihraxz Fighter"></i> <strong>Talonbane Cobra</strong></div><div class="ability pilot-ability"><mark>While you defend at attack range 3 or perform an attack at attack range 1</mark>, roll 1 additional die.</div></div><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-talent" title="talent"></i> <strong>Trick Shot</strong></div><div class="ability upgrade-ability"><mark>While you perform an attack that is obstructed by an obstacle</mark>, roll 1 additional attack die.</div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-3"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-fangfighter" title="Fang Fighter"></i> <strong>Fenn Rau</strong></div><div class="ability pilot-ability"><mark>While you defend or perform an attack, if the attack range is 1</mark>, you may roll 1 additional die.</div></div><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-talent" title="talent"></i> <strong>Fearless</strong></div><div class="ability upgrade-ability"><mark>While you perform a <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i> primary attack, if the attack range is 1 and you are in the defender&#39;s <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i></mark>, you may change 1 of your results to a <i class="xwing-miniatures-font xwing-miniatures-font-hit" title="Hit"></i> result.</div></div></td></tr>
<tr><td class="event-label engagement_phase-engage planning_phase-set_maneuver unit-0 unit-1 unit-2 unit-3" rowspan="1">Modify Attack Dice</td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-0"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-lancerclasspursuitcraft" title="Lancer-class Pursuit Craft"></i> <strong>Ketsu Onyo</strong></div><div class="ability pilot-ability"><mark>Check</mark> locks and tokens!</div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-1"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-starviperclassattackplatform" title="StarViper-class Attack Platform"></i> <strong>Guri</strong></div><div class="ability pilot-ability"><mark>Check</mark> locks and tokens!</div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-2"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-kihraxzfighter" title="Kihraxz Fighter"></i> <strong>Talonbane Cobra</strong></div><div class="ability pilot-ability"><mark>Check</mark> locks and tokens!</div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-3"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-fangfighter" title="Fang Fighter"></i> <strong>Fenn Rau</strong></div><div class="ability pilot-ability"><mark>Check</mark> locks and tokens!</div></div></td></tr>
<tr><td class="event-label engagement_phase-engage planning_phase-set_maneuver unit-0" rowspan="1">attacks</td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-0"><div class="upgrade-block"><div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-title" title="title"></i> <strong>Shadow Caster</strong></div><div class="ability upgrade-ability"><mark>After you perform an attack that hits, if the defender is in your <i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc" title="Single Turret Arc" style="color: red"></i> and your <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i></mark>, the defender gains 1 tractor token.</div></div></td><td class="phase-cell empty engagement_phase-engage planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty engagement_phase-engage planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty engagement_phase-engage planning_phase-set_maneuver">&nbsp;</td></tr>
<tr><td class="event-label engagement_phase-engage planning_phase-set_maneuver unit-2 unit-3" rowspan="1">defends</td><td class="phase-cell empty engagement_phase-engage planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell empty engagement_phase-engage planning_phase-set_maneuver">&nbsp;</td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-2"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-kihraxzfighter" title="Kihraxz Fighter"></i> <strong>Talonbane Cobra</strong></div><div class="ability pilot-ability"><mark>While you defend at attack range 3 or perform an attack at attack range 1</mark>, roll 1 additional die.</div></div></td><td class="phase-cell engagement_phase-engage planning_phase-set_maneuver unit-3"><div class="pilot-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-fangfighter" title="Fang Fighter"></i> <strong>Fenn Rau</strong></div><div class="ability pilot-ability"><mark>While you defend or perform an attack, if the attack range is 1</mark>, you may roll 1 additional die.</div></div><div class="ship-ability-block"><div class="upgrade-name"><i class="xwing-miniatures-ship xwing-miniatures-ship-fangfighter" title="Fang Fighter"></i> <strong>Concordia Faceoff</strong></div><div class="ability ship-ability"><mark>While you defend, if the attack range is 1 and you are in the attacker&#39;s <i class="xwing-miniatures-font xwing-miniatures-font-frontarc" title="Front Arc" style="color: red"></i></mark>, change 1 result to an <i class="xwing-miniatures-font xwing-miniatures-font-evade" title="Evade"></i> result.</div></div></td></tr>
    </tbody>
  </table>
</div>

<div id="focusedView">
  <div id="focusedContainer">
    <div class="content-wrapper">
      <div class="table-container">
        <!-- Table will be moved here dynamically -->
      </div>
      <div class="focus-nav-controls">
        <button onclick="navigateFocus('prev')" id="prevBtn">â—€</button>
        <span id="focusInfo"></span>
        <button onclick="closeFocusMode()">âœ•</button>
        <button onclick="navigateFocus('next')" id="nextBtn">â–¶</button>
      </div>
    </div>
  </div>
</div>

<script>
// Array of all unique game steps from all game phases
const allGameSteps = ["planning_phase-set_maneuver", "system_phase", "activation_phase-activation", "start_of_engagement_phase", "engagement_phase-engage"];
// Array of all unit class names
const allUnitClasses = ["unit-0", "unit-1", "unit-2", "unit-3"];

let focusMode = false;
let currentGameStepIndex = 0;
let currentUnitIndex = 0;
let lastFocusGameStepIndex = 0;
let lastFocusUnitIndex = 0;

function toggleFocusMode() {
  if (!focusMode && allGameSteps.length > 0 && allUnitClasses.length > 0) {
    focusMode = true;
    // Restore the last position if it was set, otherwise start from beginning
    currentGameStepIndex = lastFocusGameStepIndex;
    currentUnitIndex = lastFocusUnitIndex;
    
    // Move table to focus container table container
    const mainTable = document.getElementById('mainTable');
    const tableContainer = document.querySelector('#focusedContainer .table-container');
    tableContainer.appendChild(mainTable);
    
    showGameStepAndUnit(allGameSteps[currentGameStepIndex], allUnitClasses[currentUnitIndex]);
    document.getElementById('focusedView').style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    // Enter fullscreen mode
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen().catch(err => {
        console.log('Fullscreen request failed:', err);
      });
    } else if (document.documentElement.webkitRequestFullscreen) {
      document.documentElement.webkitRequestFullscreen();
    } else if (document.documentElement.msRequestFullscreen) {
      document.documentElement.msRequestFullscreen();
    }
    
    // Adjust navigation controls width to match table
    setTimeout(() => {
      const table = document.querySelector('#focusedContainer table');
      const navControls = document.querySelector('#focusedView .focus-nav-controls');
      if (table && navControls) {
        const tableWidth = table.offsetWidth;
        navControls.style.width = Math.max(tableWidth, 300) + 'px';
      }
    }, 100);
    
    updateFocusInfo();
  }
}

function closeFocusMode() {
  // Save current position before closing
  lastFocusGameStepIndex = currentGameStepIndex;
  lastFocusUnitIndex = currentUnitIndex;
  
  focusMode = false;
  
  // Exit fullscreen mode
  if (document.exitFullscreen) {
    document.exitFullscreen().catch(err => {
      console.log('Exit fullscreen failed:', err);
    });
  } else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
  } else if (document.msExitFullscreen) {
    document.msExitFullscreen();
  }
  
  // Move table back to original container
  const mainTable = document.getElementById('mainTable');
  const tableContainer = document.getElementById('tableContainer');
  tableContainer.appendChild(mainTable);
  
  document.getElementById('focusedView').style.display = 'none';
  document.body.style.overflow = 'auto';
  // Show all elements again
  showAllElements();
}

function navigateFocus(direction) {
  if (!focusMode || allGameSteps.length === 0 || allUnitClasses.length === 0) return;
  
  // Store the direction for auto-skip logic
  showGameStepAndUnit._lastDirection = direction;
  
  // Check if current game step is engagement phase
  const currentGameStep = allGameSteps[currentGameStepIndex];
  const isCurrentEngagementPhase = currentGameStep && currentGameStep.startsWith('engagement_phase-');
  
  if (direction === 'next') {
    if (isCurrentEngagementPhase) {
      // In engagement phase: navigate units in reverse order (last to first)
      currentUnitIndex--;
      if (currentUnitIndex < 0) {
        // Move to next step
        currentGameStepIndex = (currentGameStepIndex + 1) % allGameSteps.length;
        const nextGameStep = allGameSteps[currentGameStepIndex];
        const isNextEngagementPhase = nextGameStep && nextGameStep.startsWith('engagement_phase-');
        
        if (isNextEngagementPhase) {
          // Next step is also engagement phase: start from last unit
          currentUnitIndex = allUnitClasses.length - 1;
        } else {
          // Next step is not engagement phase: start from first unit
          currentUnitIndex = 0;
        }
      }
    } else {
      // Not in engagement phase: navigate units in normal order (first to last)
      currentUnitIndex++;
      if (currentUnitIndex >= allUnitClasses.length) {
        // Move to next step
        currentGameStepIndex = (currentGameStepIndex + 1) % allGameSteps.length;
        const nextGameStep = allGameSteps[currentGameStepIndex];
        const isNextEngagementPhase = nextGameStep && nextGameStep.startsWith('engagement_phase-');
        
        if (isNextEngagementPhase) {
          // Next step is engagement phase: start from last unit
          currentUnitIndex = allUnitClasses.length - 1;
        } else {
          // Next step is not engagement phase: start from first unit
          currentUnitIndex = 0;
        }
      }
    }
  } else if (direction === 'prev') {
    if (isCurrentEngagementPhase) {
      // In engagement phase: navigate units in reverse order (when going backwards, go from first to last)
      currentUnitIndex++;
      if (currentUnitIndex >= allUnitClasses.length) {
        // Move to previous step
        currentGameStepIndex = currentGameStepIndex > 0 ? currentGameStepIndex - 1 : allGameSteps.length - 1;
        const prevGameStep = allGameSteps[currentGameStepIndex];
        const isPrevEngagementPhase = prevGameStep && prevGameStep.startsWith('engagement_phase-');
        
        if (isPrevEngagementPhase) {
          // Previous step is also engagement phase: start from first unit
          currentUnitIndex = 0;
        } else {
          // Previous step is not engagement phase: start from last unit
          currentUnitIndex = allUnitClasses.length - 1;
        }
      }
    } else {
      // Not in engagement phase: navigate units in normal order (when going backwards, go from last to first)
      currentUnitIndex--;
      if (currentUnitIndex < 0) {
        // Move to previous step
        currentGameStepIndex = currentGameStepIndex > 0 ? currentGameStepIndex - 1 : allGameSteps.length - 1;
        const prevGameStep = allGameSteps[currentGameStepIndex];
        const isPrevEngagementPhase = prevGameStep && prevGameStep.startsWith('engagement_phase-');
        
        if (isPrevEngagementPhase) {
          // Previous step is engagement phase: start from first unit
          currentUnitIndex = 0;
        } else {
          // Previous step is not engagement phase: start from last unit
          currentUnitIndex = allUnitClasses.length - 1;
        }
      }
    }
  }
  
  showGameStepAndUnit(allGameSteps[currentGameStepIndex], allUnitClasses[currentUnitIndex]);
  
  // Adjust navigation controls width to match current table content
  setTimeout(() => {
    const table = document.querySelector('#focusedContainer table');
    const navControls = document.querySelector('#focusedView .focus-nav-controls');
    if (table && navControls) {
      const tableWidth = table.offsetWidth;
      navControls.style.width = Math.max(tableWidth, 300) + 'px';
    }
  }, 50);
  
  updateFocusInfo();
}

function hasVisibleContent() {
  const mainTable = document.getElementById('mainTable');
  if (!mainTable) return false;
  
  // Get all visible phase-cell elements
  const visiblePhaseCells = mainTable.querySelectorAll('td.phase-cell:not(.hidden)');
  
  // Check if any visible phase-cell does NOT have the 'empty' class
  for (let cell of visiblePhaseCells) {
    if (!cell.classList.contains('empty')) {
      return true; // Found at least one non-empty cell
    }
  }
  
  return false; // All visible phase-cells are empty
}

function showGameStepAndUnit(gameStep, unitClass) {
  const mainTable = document.getElementById('mainTable');
  if (!mainTable) return;
  
  // Get all th and td elements
  const allCells = mainTable.querySelectorAll('th, td');
  
  // Hide all cells first
  allCells.forEach(cell => {
    cell.classList.add('hidden');
  });
  
  // Show cells that have both the current game step and unit class in their class attribute
  allCells.forEach(cell => {
    if (cell.classList.contains(gameStep) && cell.classList.contains(unitClass)) {
      cell.classList.remove('hidden');
    }
  });
  
  // Check if all visible phase-cells are empty and auto-skip if needed
  if (!hasVisibleContent()) {
    // Use a flag to prevent infinite recursion
    if (!showGameStepAndUnit._isAutoSkipping) {
      showGameStepAndUnit._isAutoSkipping = true;
      // Determine direction based on last navigation (default to next)
      const direction = showGameStepAndUnit._lastDirection || 'next';
      autoSkipToNextContent(direction);
      showGameStepAndUnit._isAutoSkipping = false;
    }
  }
}

function autoSkipToNextContent(direction) {
  if (!focusMode || allGameSteps.length === 0 || allUnitClasses.length === 0) return;
  
  const maxAttempts = allGameSteps.length * allUnitClasses.length;
  let attempts = 0;
  
  // Keep trying to find content until we find some or exhaust all possibilities
  while (attempts < maxAttempts) {
    attempts++;
    
    // Use the same navigation logic as navigateFocus to respect engagement phase rules
    const currentGameStep = allGameSteps[currentGameStepIndex];
    const isCurrentEngagementPhase = currentGameStep && currentGameStep.startsWith('engagement_phase-');
    
    if (direction === 'next') {
      if (isCurrentEngagementPhase) {
        // In engagement phase: navigate units in reverse order (last to first)
        currentUnitIndex--;
        if (currentUnitIndex < 0) {
          // Move to next step
          currentGameStepIndex = (currentGameStepIndex + 1) % allGameSteps.length;
          const nextGameStep = allGameSteps[currentGameStepIndex];
          const isNextEngagementPhase = nextGameStep && nextGameStep.startsWith('engagement_phase-');
          
          if (isNextEngagementPhase) {
            // Next step is also engagement phase: start from last unit
            currentUnitIndex = allUnitClasses.length - 1;
          } else {
            // Next step is not engagement phase: start from first unit
            currentUnitIndex = 0;
          }
        }
      } else {
        // Not in engagement phase: navigate units in normal order (first to last)
        currentUnitIndex++;
        if (currentUnitIndex >= allUnitClasses.length) {
          // Move to next step
          currentGameStepIndex = (currentGameStepIndex + 1) % allGameSteps.length;
          const nextGameStep = allGameSteps[currentGameStepIndex];
          const isNextEngagementPhase = nextGameStep && nextGameStep.startsWith('engagement_phase-');
          
          if (isNextEngagementPhase) {
            // Next step is engagement phase: start from last unit
            currentUnitIndex = allUnitClasses.length - 1;
          } else {
            // Next step is not engagement phase: start from first unit
            currentUnitIndex = 0;
          }
        }
      }
    } else if (direction === 'prev') {
      if (isCurrentEngagementPhase) {
        // In engagement phase: navigate units in reverse order (when going backwards, go from first to last)
        currentUnitIndex++;
        if (currentUnitIndex >= allUnitClasses.length) {
          // Move to previous step
          currentGameStepIndex = currentGameStepIndex > 0 ? currentGameStepIndex - 1 : allGameSteps.length - 1;
          const prevGameStep = allGameSteps[currentGameStepIndex];
          const isPrevEngagementPhase = prevGameStep && prevGameStep.startsWith('engagement_phase-');
          
          if (isPrevEngagementPhase) {
            // Previous step is also engagement phase: start from first unit
            currentUnitIndex = 0;
          } else {
            // Previous step is not engagement phase: start from last unit
            currentUnitIndex = allUnitClasses.length - 1;
          }
        }
      } else {
        // Not in engagement phase: navigate units in normal order (when going backwards, go from last to first)
        currentUnitIndex--;
        if (currentUnitIndex < 0) {
          // Move to previous step
          currentGameStepIndex = currentGameStepIndex > 0 ? currentGameStepIndex - 1 : allGameSteps.length - 1;
          const prevGameStep = allGameSteps[currentGameStepIndex];
          const isPrevEngagementPhase = prevGameStep && prevGameStep.startsWith('engagement_phase-');
          
          if (isPrevEngagementPhase) {
            // Previous step is engagement phase: start from first unit
            currentUnitIndex = 0;
          } else {
            // Previous step is not engagement phase: start from last unit
            currentUnitIndex = allUnitClasses.length - 1;
          }
        }
      }
    }
    
    // Show the new combination without auto-skipping (to avoid recursion)
    showGameStepAndUnitWithoutAutoSkip(allGameSteps[currentGameStepIndex], allUnitClasses[currentUnitIndex]);
    
    // Check if this combination has content
    if (hasVisibleContent()) {
      updateFocusInfo();
      return; // Found content, stop searching
    }
  }
  
  // If we get here, no content was found in any combination
  updateFocusInfo();
}

function showGameStepAndUnitWithoutAutoSkip(gameStep, unitClass) {
  const mainTable = document.getElementById('mainTable');
  if (!mainTable) return;
  
  // Get all th and td elements
  const allCells = mainTable.querySelectorAll('th, td');
  
  // Hide all cells first
  allCells.forEach(cell => {
    cell.classList.add('hidden');
  });
  
  // Show cells that have both the current game step and unit class in their class attribute
  allCells.forEach(cell => {
    if (cell.classList.contains(gameStep) && cell.classList.contains(unitClass)) {
      cell.classList.remove('hidden');
    }
  });
}

function showAllElements() {
  const mainTable = document.querySelector('#mainTable');
  if (!mainTable) return;
  
  // Remove hidden class from all elements
  const hiddenElements = mainTable.querySelectorAll('.hidden');
  hiddenElements.forEach(element => {
    element.classList.remove('hidden');
  });
}

function updateFocusInfo() {
  const focusInfo = document.getElementById('focusInfo');
  if (focusInfo && allGameSteps.length > 0 && allUnitClasses.length > 0) {
    const currentStep = allGameSteps[currentGameStepIndex];
    const currentUnit = allUnitClasses[currentUnitIndex];
    const stepDisplay = currentStep.replace(/_/g, ' ').replace(/-/g, ' â†’ ');
    const totalCombinations = allGameSteps.length * allUnitClasses.length;
    const currentCombination = (currentGameStepIndex * allUnitClasses.length) + currentUnitIndex + 1;
    focusInfo.textContent = `${currentCombination}/${totalCombinations}: ${stepDisplay} (${currentUnit})`;
  }
  
  // Update button states
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  if (prevBtn) prevBtn.disabled = false;
  if (nextBtn) nextBtn.disabled = false;
}

// Handle keyboard navigation
document.addEventListener('keydown', function(e) {
  if (!focusMode) return;
  
  if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
    e.preventDefault();
    navigateFocus('next');
  } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
    e.preventDefault();
    navigateFocus('prev');
  } else if (e.key === 'Escape') {
    e.preventDefault();
    closeFocusMode();
  }
});
</script>
</body>
</html>